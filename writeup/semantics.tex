% step_do_1
\newcommand{\dostepa}
{\judgment{}
  {\(\defsstate{\sdo{\expr}} \longrightarrow
    \estate{\PCT}{\mem}{\expr}{\kdo{\cont}}\)}
}

% step_do_2
\newcommand{\dostepb}
{\judgment{}
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\kdo{\cont}} \longrightarrow
    \defsstate{\sskip}\)}
}
`
% step_seq
\newcommand{\seqstep}
{\judgment{}
  {\(\defsstate{\sseq{\stmt_1}{\stmt_2}} \longrightarrow
    \sstate{\PCT}{\mem}{\stmt_1}{\kseq{\stmt_2}{\cont}}\)}
}

% step_skip_seq
\newcommand{\seqskipstep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\sskip}{\kseq{\stmt}{\cont}} \longrightarrow
    \defsstate{\stmt}\)}
}

% step_continue_seq
\newcommand{\seqcontinuestep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\scontinue}{\kseq{\stmt}{\cont}} \longrightarrow
    \sstate{\PCT}{\mem}{\scontinue}{\cont}\)}}

% step_break_seq
\newcommand{\seqbreakstep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\sbreak}{\kseq{\stmt}{\cont}} \longrightarrow
    \sstate{\PCT}{\mem}{\sbreak}{\cont}\)}
}

% step_ifthenelse_1
\newcommand{\ifstepa}
{\judgment{\(\stmt=\sifthenelse{\expr}{\stmt_1}{\stmt_2}{L}\)}
  {\(\defsstate{\stmt} \longrightarrow
    \estate{\PCT}{\mem}{\expr}{\kif{\stmt_1}{\stmt_2}{L}{\cont}}\)}
}

% step_ifthenelse_2
\newcommand{\ifstepb}
{\judgmenttwo
  {\(\stmt' =
    \begin{cases}
      \stmt_1 & \textnormal{if } \mathit{boolof}(v) = \mathbf{t} \\
      \stmt_2 & \textnormal{if } \mathit{boolof}(v) = \mathbf{f} \\
    \end{cases}\)}
  {\(\trule{\splittres}{\splitt}\)}
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\kif{\stmt_1}{\stmt_2}{L}{\cont}}
    \longrightarrow
    \sstate{\PCT'}{\mem}{\stmt'}{\cont}\)}
}

% step_ifthen_else_2_fail

% step_while
\newcommand{\whilestep}
{\judgment{\(\stmt=\swhile{\expr}{\stmt'}{L}\)}
  {\(\defsstate{\stmt} \longrightarrow
    \estate{\PCT}{\mem}{\expr}{\kwhiletest{\expr}{\stmt'}{L}{\cont}}\)}
}

% step_while_false
\newcommand{\whilefalsestep}
{\judgmentthree
  {\(\mathit{boolof}(v) = \mathbf{f}\)}
  {\(\cont = \kwhiletest{\expr}{\stmt}{L}{\cont'}\)}
  {\(\color{blue} \splittres \leftarrow \splitt \)}
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\cont}
    \longrightarrow
    \sstate{\PCT'}{\mem}{\sskip}{\cont'}\)}
}

% step_while_true
\newcommand{\whiletruestep}
{\judgmenttwobr
  {\(\mathit{boolof}(v) = \mathbf{t}\)}
  {\(\cont_1 = \kwhiletest{\expr}{\stmt}{L}{\cont}\)}
  {\(\cont_2 = \kwhileloop{\expr}{\stmt}{L}{\cont}\)}
  {\(\color{blue} \splittres \leftarrow \splitt \)}  
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\cont_1}
    \longrightarrow
    \sstate{\PCT'}{\mem}{\stmt}{\cont_2}\)}
}

% step_skip_or_continue_while
\newcommand{\whileskipcontinuestep}
{\judgmenttwo{\(\stmt = \sskip \lor \stmt = \scontinue\)}
  {\(\cont = \kwhileloop{\expr}{\stmt}{L}{\cont'}\)}
  {\(\defsstate{\stmt} \longrightarrow
    \sstate{\PCT}{\mem}{\swhile{\expr}{\stmt}{L}}{\cont'}\)}}

% step_break_while
\newcommand{\whilebreakstep}
{\judgment{\(\cont = \kwhileloop{\expr}{\stmt}{L}{\cont'}\)}
  {\(\sstate{\PCT}{\mem}{\sbreak}{\cont} \longrightarrow
    \sstate{\PCT}{\mem}{\sskip}{\cont'}\)}}

% step_dowhile
\newcommand{\dowhilestep}
{\judgmenttwo{\(\stmt = \sdowhile{\expr}{\stmt'}{L}\)}
  {\(\cont' = \kdowhileloop{\expr}{\stmt'}{L}{\cont}\)}
  {\(\defsstate{\stmt} \longrightarrow
    \sstate{\PCT}{\mem}{\stmt'}{\cont'}\)}
}

% step_skip_or_continue_dowhile
\newcommand{\dowhileskipcontinuestep}
{\judgmenttwo
  {\(\cont_1 = \kdowhileloop{\expr}{\stmt}{L}{\cont'}\)}
  {\(\cont_2 = \kdowhiletest{\expr}{\stmt}{L}{\cont}\)}
  {\(\sstate{\PCT}{\mem}{\stmt' = \sskip \lor \stmt' = \scontinue}{\cont_1} \longrightarrow
    \estate{\PCT}{\mem}{\expr}{\cont_2}\)}}

% step_dowhile_false
\newcommand{\dowhilefalsestep}
{\judgmentthree
  {\(\mathit{boolof}(v) = \mathbf{f}\)}
  {\(\cont = \kdowhiletest{\expr}{\stmt}{L}{\cont'}\)}
  {\(\color{blue} \splittres \leftarrow \splitt\)}
  {\(\sstate{\PCT}{\mem}{\val{v}{\vt}}{\cont}
    \longrightarrow
    \sstate{\PCT'}{\mem}{\sskip}{\cont'}\)}
}

% step_dowhile_true
\newcommand{\dowhiletruestep}
{\judgmentthree
  {\(\mathit{boolof}(v) = \mathbf{t}\)}
  {\(\cont = \kdowhiletest{\expr}{\stmt}{L}{\cont'}\)}
  {\(\color{blue} \splittres \leftarrow \splitt\)}
  {\(\sstate{\PCT}{\mem}{\val{v}{\vt}}{\cont}
    \longrightarrow
    \sstate{\PCT'}{\mem}{\sdowhile{\expr}{\stmt}{L}}{\cont'}\)}
}

% step_break_dowhile
\newcommand{\dowhilebreakstep}
{\judgment{\(\cont = \kdowhileloop{\expr}{\stmt}{L}{\cont'}\)}
  {\(\sstate{\PCT}{\mem}{\sbreak}{\cont} \longrightarrow
    \sstate{\PCT}{\mem}{\sskip}{\cont'}\)}}

% step_for_start
\newcommand{\forinitstep}
{\judgmenttwo
  {\(\stmt = \sfor{\stmt_1}{\expr}{\stmt_2}{\stmt_3}{L}\)}
  {\(\stmt_1 \not = \sskip\)}
  {\(\defsstate{\stmt} \longrightarrow
  \sstate{\PCT}{\mem}{\stmt_1}{\kseq{\sfor{\sskip}{\expr}{\stmt_2}{\stmt_3}{L}}{\cont}}\)}
}

% step_for
\newcommand{\forstep}
{\judgment{\(\stmt = \sfor{\sskip}{\expr}{\stmt_2}{\stmt_3}{L}\)}
  {\(\defsstate{\stmt} \longrightarrow
  \estate{\PCT}{\mem}{\expr}{\kfor{\expr}{\stmt_2}{\stmt_3}{L}{\cont}}\)}
}

% step_for_false
\newcommand{\forfalsestep}
{\judgmenttwo{\(\mathit{boolof}(v) = \mathbf{f}\)}
  {\(\color{blue} \splittres \leftarrow \splitt\)}
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\kfor{\expr}{\stmt_2}{\stmt_3}{L}{\cont}} \longrightarrow
    \sstate{\PCT}{\mem}{\sskip}{\cont}\)}
}

% step_for_true
\newcommand{\fortruestep}
{\judgmentthree{\(\cont = \kfor{\expr}{\stmt_2}{\stmt_3}{L}{\cont'}\)}
  {\(\mathit{boolof}(v) = \mathbf{t}\)}
  {\(\color{blue} \splittres \leftarrow \splitt\)}
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\cont} \longrightarrow
      \sstate{\PCT}{\mem}{\stmt_3}{\cont}\)}
}

% step_skip_or_continue
\newcommand{\forskiporcontinuestep}
{\judgmenttwo{\(\cont = \kfor{\expr}{\stmt_2}{\stmt_3}{L}\)}
  {\(\stmt = \sskip \lor \stmt = \scontinue\)}
  {\(\sstate{\PCT}{\mem}{\stmt}{\cont}
    \longrightarrow
    \sstate{\PCT}{\mem}{\sfor{\sskip}{\expr}{\stmt_2}{\stmt_3}{L}}{\kforpost{\expr}{\stmt_2}{\stmt_3}{L}{\cont}}\)}
}

% step_break_for3
\newcommand{\forbreakstep}
{\judgment{\(\cont = \kfor{\expr}{\stmt_1}{\stmt_2}{L}{\cont'}\)}
  {\(\sstate{\PCT}{\mem}{\sbreak}{\cont}
    \longrightarrow
    \sstate{\PCT}{\mem}{\sskip}{\cont'}\)}
}

% step_skip_for4
\newcommand{\forskippoststep}
{\judgment{\(\cont = \kforpost{\expr}{\stmt_2}{\stmt_3}{L}{\cont'}\)}
  {\(\defsstate{\sskip}
    \longrightarrow
    \defsstate{\sfor{\sskip}{\expr}{\stmt_2}{\stmt_3}{L}}\)}
}

% step_return_0
\newcommand{\retnovalstep}
{\judgment{\(\mathit{dealloc} ~ \mem ~ \PCT = (\PCT',\mem')\)}
  {\(\sstate{\PCT}{\mem}{\sreturn{}}{\cont}
    \longrightarrow
    \rstate{\PCT'}{\mem'}{\val{\vundef}{\deftag}}{\cont}\)}
}

% step_return_1
\newcommand{\retexprstep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\sreturn{\expr}}{\cont}
    \longrightarrow
    \estate{\PCT}{\mem}{\expr}{\kreturn{\cont}}\)}
}

% step_return_2
\newcommand{\retvalstep}
{\judgment{\(\mathit{dealloc} ~ \mem ~ \PCT = (\PCT',\mem')\)}
  {\(\estate{\PCT}{\mem}{\sreturn{\val{v}{\vt}}}{\kreturn{\cont}}
    \longrightarrow
    \rstate{\PCT}{\mem}{\val{v}{\vt}}{\cont}\)}
}

% step_skip_call
\newcommand{\skipreturnstep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\sskip}{\kcall{\cont}}
    \longrightarrow
    \rstate{\PCT}{\mem}{\val{\vundef}{\deftag}}{\cont}\)}
}
  
% step_switch
\newcommand{\switchstep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\sswitch{\expr}{\overline{(v,\stmt)}}{L}}{\cont}
    \longrightarrow
    \estate{\PCT}{\mem}{\expr}{\kswitcha{\overline{(v,\stmt)}}{L}{\cont}}\)}
}

% step_expr_switch
\newcommand{\switchvalstep}
{\judgmenttwo{\(\mathit{select} ~ v ~ \overline{(v,\stmt)} = \stmt\)}
  {\(\color{blue} \splittres \leftarrow \splitt\)}
  {\(\estate{\PCT}{\mem}{\val{v}{\vt}}{\kswitcha{\overline{(v,\stmt)}}{L}{\cont}}
    \longrightarrow
    \sstate{\PCT'}{\mem}{\stmt}{\kswitchb{\cont}}\)}
}
  
% step_skip_break_switch
\newcommand{\switchskiporbreakstep}
{\judgment{\(\stmt = \sbreak \lor \stmt = \sskip\)}
  {\(\sstate{\PCT}{\mem}{\stmt}{\kswitchb{\cont}}
    \longrightarrow
    \sstate{\PCT}{\mem}{\sskip}{\cont}\)}
}

% step_continue_switch
\newcommand{\switchcontinuestep}
{\judgment{}
  {\(\sstate{\PCT}{\mem}{\scontinue}{\kswitchb{\cont}}
    \longrightarrow
    \sstate{\PCT}{\mem}{\scontinue}{\cont}\)}
}

% step_label
\newcommand{\labelstep}
{\judgment
  {\(\color{blue} \labeltres \leftarrow \labelt\)}
  {\(\sstate{\PCT}{\mem}
    {\slabel{L}{\stmt}}{\cont} \longrightarrow
    \sstate{\PCT'}{\mem}{\stmt}{\cont}\)}
}

% step_goto
\newcommand{\gotostep}
{\judgment{\(\mathit{findlabel}(L) = \slabel{L}{\stmt}\)}
  {\(\sstatefun{f}{\PCT}{\mem}{\goto{L}}{\cont}
    \longrightarrow
    \sstatefun{f}{\PCT}{\mem}{\slabel{L}{\stmt}}{\pop(\cont)}\)}}

% step_internal_function
\newcommand{\callstep}
{\judgmentbr{\(\mathit{def}(f) = \mathit{internal}(xs, \stmt)\)}
  {\(\lenv' = \lenv \llbracket x \mapsto v@\vt' \mid
    (x,v@\vt) \leftarrow \mathit{zip}(xs,args), \vt' \leftarrow \argt \rrbracket\)}
  {\(\cstate{\PCT}{\mem}{f}{args}{\cont} \longrightarrow
    \sstate{\PCT}{\mem}{\genv}{\lenv'}{\stmt}{\cont}\)}}

% step_external_function

% specific external function
\newcommand{\mallocstep}
{\judgmenttwobrlong
    {\(\trule{\malloctres}{\malloct}\)}
    {\(\mem',p \leftarrow \mathit{heap\_alloc} ~ \mathit{size} ~ \mem\)}
    {\(\mem'' = \mem'\left[p + i \mapsto (\vundef,\vt,\lt) \mid 0 \leq i < s\right]\)}
    {\(\defestate{\ctx{\mathit{malloc(\mathit{size}@t)}}}
      \longrightarrow
      \estate{\PCT'}{\mem''}
             {\ctx{\val{p}{\pt}}}{\cont}\)}}

% step_returnstate
\newcommand{\returnstep}
{\judgmenttwo{\(\cont = \mathit{Kcall} ~ \lenv' ~ \mathit{ctx} ~ \cont'\)}
  {\(\PCT'',\vt' \leftarrow \rett\)}
  {\(\rstate{\PCT}{\mem}{\val{v}{\vt}}{\cont} \longrightarrow
    \estate{\PCT'}{\mem}{\mathit{ctx}[\val{v}{\vt'}]}{\cont'}\)}}

% lred_var_local
\newcommand{\varlocalstep}
{\judgment{\(\lenv[id] = (l,\_,\pt,ty)\)}
  {\(\var{id}
    \Rightarrow_\lh
    \loc{l}{\pt}\)}}

% lred_var_global
\newcommand{\varglobalstep}
{\judgmenttwo{\(\lenv[id] = \bot\)}
  {\(\genv[id] = (l,\_,\pt,ty)\)}
  {\(\var{id}
    \Rightarrow_\lh
    \loc{l}{\pt}\)}}

% rred_deref
\newcommand{\derefstep}
{\judgment{}
  {\((\PCT,\mem,\deref{(\val{v}{\vt})})
    \Rightarrow_\rh
    (\PCT,\mem,\loc{(\mathit{to\_ptr} ~ v)}{\vt})\)}}

% lred_field_struct or lred_field_union
\newcommand{\fieldstructstep}
{\judgmentthree{\(\type = \mathit{TStruct} ~ id \lor \type = \mathit{TUnion} ~ id\)}
  {\(\mathit{offset} ~ id ~ fld = \delta\)}
  {\(\trule{\fieldtres}{\fieldt}\)}
  {\(\field{(\val{p}{\pt}:\type)}{fld})
    \Rightarrow_\lh
    \loc{(p+\delta)}{\pt'}\)}
}

% rred_rval_of
\newcommand{\valofstep}
{\judgmenttwo{\(\mem[l]_{|ty|} = v@\vt@\overline{\lt}\)}
  {\(\trule{\loadtres}{\loadt}\)}
  {\((\PCT, \mem, \valof{(\loc{l}{\pt})}:\type)
    \Rightarrow_\rh
    (\PCT, \mem, \val{v}{\vt'})\)}}

% rred_addrof
\newcommand{\addrofstep}
{\judgment{}
  {\((\PCT,\mem,\addrof{(\loc{p}{\pt})})
    \Rightarrow_\rh
    (\PCT,\mem,\val{p}{\pt})\)}}
  
% rred_unop
\newcommand{\unopstep}
{\judgmenttwo{\(\left\langle \odot \right\rangle v = v'\)}
            {\(\trule{\unoptres}{\unopt}\)}
            {\((\PCT,\mem,\unop{\odot}{(\val{v}{\vt})})
              \Rightarrow_\rh
              (\PCT,\mem, \val{v'}{\vt'})\)}}

% rred_binop
\newcommand{\binopstep}
{\judgmenttwobrlong{\(v_1 \left\langle \oplus \right\rangle v_2 = v'\)}
  {\(\trule{\binoptres}{\binopt}\)}
  {\(\expr = \binop{\oplus}{(\val{v_1}{\vt_1})}{(\val{v_2}{\vt_2})}\)}
  {\((\PCT,\mem,\expr)
    \Rightarrow_\rh
    (\PCT,\mem,\val{v'}{\vt'})\)}}

% rred_cast
\newcommand{\iicaststep}
{\judgmentthree{\(\neg \mathit{isptr}(\type_1)\)}
  {\(\neg \mathit{isptr}(\type_2)\)}
  {\(\trule{\iicasttres}{\iicastt}\)}
  {\((\PCT,\mem,\cast{(\val{v}{\vt}:\type_1)}{\type_2})
    \Rightarrow_\rh
    (\PCT,\mem,\val{v}{\vt'}:\type_2)\)}}
  
% step_rred + red_ipcast
\newcommand{\ipcaststep}
{\judgmenttwobr{\(\neg \mathit{isptr}(\type_1)\)}
  {\(\type_2 = \mathit{ptr} ~ \type_2'\)}
  {\(\mem[v]_{|\type_2'|} = \_@\vt_2@\overline{\lt}\)}
  {\(\trule{\ipcasttres}{\ipcastt}\)}
  {\(\defestate{\cast{(\val{v}{\vt_1}:\type_1)}{\type_2}}
    \longrightarrow
    \defestate{\val{v}{\pt}:\type_2}\)}}

% step_rred + red_picast
\newcommand{\picaststep}
{\judgmenttwobr{\(\type_1 = \mathit{ptr} ~ \type_1'\)}
  {\(\neg \mathit{isptr}(\type_2)\)}
  {\(\mem[v]_{|\type_1'|} = \_@\vt@\overline{\lt}\)}
  {\(\trule{\picasttres}{\picastt}\)}
  {\(\defestate{\cast{(\val{v}{\pt}:\type_1)}{\type_2}}
    \longrightarrow
    \defestate{\val{v}{\vt'}:\type_2}\)}}

% step_rred + red_ppcast
\newcommand{\ppcaststep}
{\judgmenttwobr{\(\type_1 = \mathit{ptr} ~ \type_1'\)}
  {\(\type_2 = \mathit{ptr} ~ \type_2'\)}
  {\(\mem[v]_{|\type_1'|} = \mem[v]_{|\type_2'|} = \_@\vt@\overline{\lt}\)}
  {\(\trule{\ppcasttres}{\ppcastt}\)}
  {\(\defestate{\cast{(\val{v}{\pt}:\type_1)}{\type_2}}
    \longrightarrow
    \defestate{\val{v}{\pt'}:\type_2}\)}}

% step_rred + red_seqand_true
\newcommand{\seqandtruestep}
{\judgmenttwo{\(\mathit{boolof}(v) = \mathbf{t}\)}
  {\(\trule{\exprsplittres}{\exprsplitt}\)}
  {\(\defestate{\ctx{\seqand{(\val{v}{\vt})}{\expr}}}
  \longrightarrow
  \defestate{\ctx{\paren{\expr}{\mathit{Tbool}}{\PCT'}}}\)}}

% step_rred + red_seqand_false
\newcommand{\seqandfalsestep}
{\judgmenttwo{\(\mathit{boolof}(v) = \mathbf{f}\)}
  {\(\trule{\exprsplittres}{\exprsplitt}\)}
  {\(\defestate{\ctx{\seqand{(\val{v}{\vt})}{\expr}}}
    \longrightarrow
    \defestate{\ctx{\paren{(\val{0}{\vt'})}{\mathit{Tbool}}{\PCT'}}}\)}}

% step_rred + red_seqor_true
\newcommand{\seqortruestep}
{\judgmenttwo{\(\mathit{boolof}(v) = \mathbf{t}\)}
  {\(\trule{\exprsplittres}{\exprsplitt}\)}
  {\(\defestate{\ctx{\seqor{(\val{v}{\vt})}{\expr}}}
    \longrightarrow
    \defestate{\ctx{\paren{(\val{1}{\vt'})}{\mathit{Tbool}}{\PCT'}}}\)}}

% step_rred + red_seqor_false
\newcommand{\seqorfalsestep}
{\judgmenttwo{\(\mathit{boolof}(v) = \mathbf{f}\)}
  {\(\trule{\exprsplittres}{\exprsplitt}\)}
  {\(\defestate{\ctx{\seqor{(\val{v}{\vt})}{\expr}}}
  \longrightarrow
  \defestate{\ctx{\paren{\expr}{\mathit{Tbool}}{\PCT'}}}\)}}

% step_rred + red_condition
\newcommand{\conditionstep}
{\judgmenttwo{\(\expr' =
    \begin{cases}
      \expr_1 & \textnormal{if } \mathit{boolof}(v) = \mathbf{t} \\
      \expr_2 & \textnormal{if } \mathit{boolof}(v) = \mathbf{f} \\
    \end{cases}\)}
  {\(\trule{\exprsplittres}{\exprsplitt}\)}
  {\(\defestate{\ctx{\condition{(\val{v}{\vt})}{\expr_1}{\expr_2}}}
    \longrightarrow
  \defestate{\ctx{\paren{\expr'}{}{\PCT'}}}\)}}

% step_rred + red_sizeof

% step_rred + red_alignof

% step_rred + red_assign
\newcommand{\assignstep}
{\judgmenttwobrlong{\(\mem[l]_{|ty|} = v_1@\vt_1@\overline{\lt}\)}
  {\(\mem' = \mem[l \mapsto v_2@\vt' @\overline{\lt}']\)}
  {\(\trule{\storetres}{\storet}\)}
  {\(\defestate
    {\ctx{\assign{(\loc{l}{\pt})}{(\val{v_2}{\vt_2})}}}
    \longrightarrow
    \estate{\PCT'}{\mem'}
           {\ctx{\val{v_2}{\vt_2}}}{\cont}\)}}

% step_rred + red_assignop
\newcommand{\assignopstep}
{\judgmenttwobr{\(\mem[l]_{|ty|} = v_1@\vt @\overline{\lt}\)}
  {\(\oplus \in \{+,-,*,/,\%,<<,>>,\&,^\wedge,|\}\)}
  {\(\trule{\loadtres}{\loadt}\)}
  {\(\expr = \assign{(\loc{l}{\pt})}
    {(\binop{\oplus}
      {(\val{v_1}{\vt'})}
      {(\val{v_2}{\vt_2})})}\)}
  {\(\defestate
    {\ctx{\assignop{\oplus}{(\loc{l}{\pt})}
        {(\val{v_2}{\vt_2})}}}
    \longrightarrow
    \defestate
        {\ctx{\expr}}\)}}

% step_rred + red_postincr
\newcommand{\postincstep}
{\judgmenttwobr{\(\mem[l] = v@\vt @\overline{\lt}\)}
  {\(\oplus \in \{+,-\}\)}
  {\(\trule{\loadtres}{\loadt}\)}
  {\(\expr = \comma{\assign{\loc{l}{\pt}}{\binop{\oplus}{\val{v}{\vt'}}{1@\deftag}}}
    {\val{v}{\vt'}} \)}
  {\(\defestate
    {\ctx{\postinc{\oplus}
        {\loc{l}{\pt}}}}
    \longrightarrow
    \defestate
        {\ctx{\expr}}\)}}

% step_rred + red_comma
\newcommand{\commastep}
{\judgment{}
  {\(\defestate{\comma{\val{v}{\vt}}{\expr}}
    \longrightarrow
    \defestate{\expr}\)}}

% step_rred + red_paren
\newcommand{\parenstep}
{\judgmenttwo
  {\(\defestate{\paren{\val{v}{\vt}}{\gentag}}\)}
  {\(\vt' \leftarrow \exprjoint\)}
  {\(\defestate{\val{v}{\vt'}}\)}}

% step_rred + red_builtin

% step_callred
\newcommand{\callexprstep}
{\judgment{}
  {\(\estate{\PCT}{\mem}{\ctx{\call{f'}{\overline{v @ \vt}}}{ty}}{\cont}
    \longrightarrow
    \cstate{f'}{\PCT}{\mem}{\lenv}{v @ \vt}{\kcall{f}{\ctx{}}{\cont}}\)}}

\newcommand{\sequencing}
{
  \dostepa
  \dostepb
  \seqstep
  \seqskipstep
  \seqcontinuestep
  \seqbreakstep
  \labelstep
}

\newcommand{\conditionals}
{

  \ifstepa
  \ifstepb
  \vspace{2\belowdisplayskip}
  \switchstep
  \switchvalstep
  \switchskiporbreakstep
  \switchcontinuestep
}

\newcommand{\while}
{
  \whilestep
  \whiletruestep
  \whilefalsestep
  \whileskipcontinuestep
  \whilebreakstep
}

\newcommand{\dowhile}
{
  \dowhilestep
  \dowhileskipcontinuestep
  \dowhilefalsestep
  \dowhiletruestep
  \dowhilebreakstep
}

\newcommand{\forloop}
{
  \forinitstep
  \forstep
  \forfalsestep
  \fortruestep
  \forskiporcontinuestep
  \forbreakstep
  \forskippoststep
}

\newcommand{\loops}
{
  \while
  \vspace{2\belowdisplayskip}
  \dowhile
  \vspace{2\belowdisplayskip}
  \forloop
}

\newcommand{\expressions}
{
  \varlocalstep
  \varglobalstep
  \derefstep
  \fieldstructstep
  \valofstep
  \addrofstep
  \unopstep
  \binopstep
  \iicaststep
  \picaststep
  \ipcaststep
  \ppcaststep
  \seqandtruestep
  \seqandfalsestep
  \seqortruestep
  \seqorfalsestep
  \conditionstep
  \assignstep
  \assignopstep
  \postincstep
  \commastep
  \parenstep
}
